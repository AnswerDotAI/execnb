# nbio


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Reading a notebook

A notebook is just a json file.

<details open class="code-fold">
<summary>Exported source</summary>

``` python
def _read_json(self, encoding=None, errors=None):
    return loads(Path(self).read_text(encoding=encoding, errors=errors))
```

</details>

``` python
minimal_fn = Path('../tests/minimal.ipynb')
minimal_txt = AttrDict(_read_json(minimal_fn))
```

It contains two sections, the `metadata`…:

``` python
minimal_txt.metadata
```

    {'solveit_dialog_mode': 'learning', 'solveit_ver': 2}

…and, more importantly, the `cells`:

``` python
minimal_txt.cells
```

    [{'cell_type': 'markdown',
      'id': '801558df',
      'metadata': {},
      'source': ['## A minimal notebook']},
     {'cell_type': 'code',
      'execution_count': None,
      'id': 'e2147a69',
      'metadata': {'time_run': '2026-01-04T20:52:49.901559+00:00'},
      'outputs': [{'data': {'text/plain': ['2']},
        'execution_count': 0,
        'metadata': {},
        'output_type': 'execute_result'}],
      'source': ['# Do some arithmetic\n', '1+1']}]

The second cell here is a `code` cell, however it contains no outputs,
because it hasn’t been executed yet. To execute a notebook, we first
need to convert it into a format suitable for `nbclient` (which expects
some `dict` keys to be available as attrs, and some available as regular
`dict` keys). Normally, `nbformat` is used for this step, but it’s
rather slow and inflexible, so we’ll write our own function based on
`fastcore`’s handy `dict2obj`, which makes all keys available as both
attrs *and* keys.

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L22"
target="_blank" style="float:right; font-size:smaller">source</a>

### NbCell

``` python

def NbCell(
    idx, cell
):

```

*`dict` subclass that also provides access to keys as attrs*

We use an `AttrDict` subclass which has some basic functionality for
accessing notebook cells.

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L52"
target="_blank" style="float:right; font-size:smaller">source</a>

### dict2nb

``` python

def dict2nb(
    js:NoneType=None, kwargs:VAR_KEYWORD
):

```

*Convert dict `js` to an `AttrDict`,*

We can now convert our JSON into this `nbclient`-compatible format,
which pretty prints the source code of cells in notebooks.

``` python
minimal = dict2nb(minimal_txt)
cell = minimal.cells[1]
cell
```

``` python
{ 'cell_type': 'code',
  'execution_count': None,
  'id': 'e2147a69',
  'idx_': 1,
  'metadata': {'time_run': '2026-01-04T20:52:49.901559+00:00'},
  'outputs': [ { 'data': {'text/plain': ['2']},
                 'execution_count': 0,
                 'metadata': {},
                 'output_type': 'execute_result'}],
  'source': '# Do some arithmetic\n1+1'}
```

The abstract syntax tree of source code cells is available in the
`parsed_` property:

``` python
cell.parsed_(), cell.parsed_()[0].value.op
```

    ([<ast.Expr>], <ast.Add>)

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L59"
target="_blank" style="float:right; font-size:smaller">source</a>

### read_nb

``` python

def read_nb(
    path
):

```

*Return notebook at `path`*

This reads the JSON for the file at `path` and converts it with
[`dict2nb`](https://AnswerDotAI.github.io/execnb/nbio.html#dict2nb). For
instance:

``` python
minimal = read_nb(minimal_fn)
str(minimal.cells[0])
```

    "{'cell_type': 'markdown', 'id': '801558df', 'metadata': {}, 'source': '## A minimal notebook', 'idx_': 0}"

The file name read is stored in `path_`:

``` python
minimal.path_
```

    '../tests/minimal.ipynb'

## Creating a notebook

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L66"
target="_blank" style="float:right; font-size:smaller">source</a>

### mk_cell

``` python

def mk_cell(
    text, # `source` attr in cell
    cell_type:str='code', # `cell_type` attr in cell
    kwargs:VAR_KEYWORD
):

```

*Create an
[`NbCell`](https://AnswerDotAI.github.io/execnb/nbio.html#nbcell)
containing `text`*

``` python
mk_cell('print(1)', execution_count=0)
```

``` python
{ 'cell_type': 'code',
  'directives_': {},
  'execution_count': 0,
  'id': 'f6ddf5a3',
  'idx_': 0,
  'metadata': {},
  'outputs': [],
  'source': 'print(1)'}
```

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L78"
target="_blank" style="float:right; font-size:smaller">source</a>

### new_nb

``` python

def new_nb(
    cells:NoneType=None, meta:NoneType=None, nbformat:int=4, nbformat_minor:int=5
):

```

*Returns an empty new notebook*

Use this function when creating a new notebook. Useful for when you
don’t want to create a notebook on disk first and then read it.

## Writing a notebook

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L84"
target="_blank" style="float:right; font-size:smaller">source</a>

### nb2dict

``` python

def nb2dict(
    d, k:NoneType=None
):

```

*Convert parsed notebook to `dict`*

This returns the exact same dict as is read from the notebook JSON.

``` python
minimal_fn = Path('../tests/minimal.ipynb')
minimal = read_nb(minimal_fn)
minimal_dict = _read_json(minimal_fn)
assert minimal_dict==nb2dict(minimal)
```

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L92"
target="_blank" style="float:right; font-size:smaller">source</a>

### nb2str

``` python

def nb2str(
    nb
):

```

*Convert `nb` to a `str`*

To save a notebook we first need to convert it to a `str`:

``` python
print(nb2str(minimal)[:45])
```

    {
     "cells": [
      {
       "cell_type": "markdown",

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/execnb/blob/main/execnb/nbio.py#L98"
target="_blank" style="float:right; font-size:smaller">source</a>

### write_nb

``` python

def write_nb(
    nb, path
):

```

*Write `nb` to `path`*

This returns the exact same string as saved by Jupyter.

``` python
tmp = Path('tmp.ipynb')
try:
    minimal_txt = minimal_fn.read_text()
    write_nb(minimal, tmp)
    test_eq(minimal_txt, tmp.read_text())
finally: tmp.unlink()
```

Here’s how to put all the pieces of `execnb.nbio` together:

``` python
nb = new_nb([mk_cell('print(1)')])
path = Path('test.ipynb')
write_nb(nb, path)
nb2 = read_nb(path)
print(nb2.cells)
path.unlink()
```

    [{'cell_type': 'code', 'execution_count': 0, 'id': '5e7ed95f', 'metadata': {}, 'outputs': [], 'source': 'print(1)', 'idx_': 0}]
