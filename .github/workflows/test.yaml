name: CI
on:  [workflow_dispatch, pull_request, push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: fastai/workflows/nbdev-ci@master
        with:
          version: ${{ matrix.version }}
          pre: 1
  nbdev-integration-test:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: pip install -Ue ".[dev]"
      - name: clone nbdev
        uses: actions/checkout@v3
        with:
          repository: 'fastai/nbdev'
          path: nbdev
      - name: Run nbdev tests
        run: |
          git config --global user.email "${GH_EMAIL}"
          git config --global user.name "${GH_USERNAME}"
          cd nbdev && pip install -Ue ".[dev]"
          nbdev_test
    
